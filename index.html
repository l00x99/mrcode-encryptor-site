<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MR CODE â€” ØªØ´ÙÙŠØ± & ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ±</title>
  <meta name="description" content="MR CODE â€” Ø£Ø¯Ø§Ø© ØªØ´ÙÙŠØ± ÙˆÙÙƒ ØªØ´ÙÙŠØ± Ù…Ø­Ù„ÙŠØ© Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ØªØµÙØ­ØŒ Ø¨Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ§Øª Ù…ØªØ¹Ø¯Ø¯Ø©ØŒ ÙˆÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¨ÙŠØ©/Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©.">
  <link rel="icon" href="./assets/favicon.svg">
  <style>
    :root{
      --bg:#0b1220;--fg:#e5e7eb;--muted:#94a3b8;--card:#0f172a;--line:#1f2937;--brand:#7c3aed;--brand2:#22c55e;--accent:#38bdf8;--warn:#f97316;--radius:18px;
    }
    body.light{
      --bg:#f6f7fb;--fg:#0b1220;--muted:#475569;--card:#ffffff;--line:#e5e7eb;--brand:#7c3aed;--brand2:#16a34a;--accent:#0ea5e9;--warn:#ea580c;
    }
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,"Noto Naskh Arabic","Almarai",Tahoma,sans-serif;
      background:var(--bg);color:var(--fg);overflow-x:hidden}
    a{color:inherit;text-decoration:none}
    .container{max-width:1200px;margin:0 auto}
    /* Animated cosmic background */
    .bg-circle{position:fixed;pointer-events:none;border-radius:50%;filter:blur(20px);opacity:.45;mix-blend-mode:screen}
    .bg1{width:420px;height:420px;background:radial-gradient(circle,#7c3aed66,#0000);top:-120px;left:-120px;animation:pulse 10s ease-in-out infinite}
    .bg2{width:300px;height:300px;background:radial-gradient(circle,#38bdf866,#0000);bottom:-120px;right:-120px;animation:pulse 12s ease-in-out infinite 2s}
    .bg3{width:220px;height:220px;background:radial-gradient(circle,#22c55e66,#0000);top:40%;left:50%;transform:translate(-50%,-50%);animation:pulse 14s ease-in-out infinite 4s}
    @keyframes pulse{0%{transform:translate(var(--tx,0),var(--ty,0)) scale(.9)}50%{transform:translate(var(--tx,0),var(--ty,0)) scale(1.1)}100%{transform:translate(var(--tx,0),var(--ty,0)) scale(.9)}}
    /* Header */
    .header{max-width:1200px;margin:0 auto;padding:18px 16px;display:flex;align-items:center;justify-content:space-between;position:relative;z-index:2}
    .brand{display:flex;align-items:center;gap:10px;font-weight:900}
    .logo{width:34px;height:34px;border-radius:10px;background:conic-gradient(from 0deg,var(--brand),var(--accent),var(--brand2));
      box-shadow:0 0 40px rgba(124,58,237,.35)}
    .nav{display:flex;gap:8px;align-items:center}
    .btn{border:1px solid var(--line);background:transparent;color:var(--fg);padding:10px 12px;border-radius:14px;font-weight:700;cursor:pointer;position:relative;overflow:hidden}
    .btn-primary{border:0;background:linear-gradient(90deg,var(--brand),var(--accent));color:#0b1020}
    .btn::after{content:"";position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle,rgba(255,255,255,.35) 10%,transparent 60%);transform:scale(0);transition:transform .45s}
    .btn:active::after{transform:scale(1);transition:0s}
    .badge{font-size:12px;color:#0b1020;background:linear-gradient(90deg,var(--brand2),var(--accent));padding:6px 10px;border-radius:999px;font-weight:800}
    /* Hero */
    .hero{max-width:1200px;margin:10px auto 0;display:grid;grid-template-columns:1.2fr .8fr;gap:16px;padding:0 16px;position:relative;z-index:1}
    @media(max-width:980px){.hero{grid-template-columns:1fr}}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));border:1px solid var(--line);
      border-radius:var(--radius);box-shadow:0 20px 60px rgba(0,0,0,.25);overflow:hidden}
    .card .head{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--line);
      background:linear-gradient(180deg,transparent,rgba(255,255,255,.02))}
    .title{font-size:20px;margin:0}
    .muted{color:var(--muted);font-size:12px}
    textarea,input,select{width:100%;box-sizing:border-box}
    textarea{min-height:240px;background:var(--card);border:1px solid var(--line);border-radius:14px;color:var(--fg);padding:12px;font-size:15px;line-height:1.9}
    .panel{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .stack{display:grid;gap:12px}
    .chips{display:flex;flex-wrap:wrap;gap:6px}
    .chip{border:1px solid var(--line);padding:6px 10px;border-radius:999px;font-size:12px;color:var(--muted)}
    .out{min-height:240px;white-space:pre-wrap;line-height:1.9}
    .mono{font-family:ui-monospace,monospace}
    .footer{max-width:1200px;margin:20px auto;padding:12px 16px;color:var(--muted);display:flex;justify-content:space-between;align-items:center}
    .hero-sub{max-width:1200px;margin:8px auto 10px;padding:0 16px;display:flex;justify-content:space-between;align-items:center;gap:8px;position:relative;z-index:1}
    /* Modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.55);backdrop-filter:blur(6px);z-index:30}
    .modal.open{display:flex}
    .modal-card{max-width:680px;width:90%;background:var(--card);border:1px solid var(--line);border-radius:18px;box-shadow:0 20px 60px rgba(0,0,0,.4)}
    .modal-head{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid var(--line)}
    .modal-body{padding:14px}
  </style>
</head>
<body class="dark" data-lang="ar">
  <div class="bg-circle bg1"></div>
  <div class="bg-circle bg2"></div>
  <div class="bg-circle bg3"></div>

  <header class="header">
    <div class="brand">
      <div class="logo"></div>
      <div id="t_brand_top">MR CODE <span class="muted" id="t_brand_sublabel">Ù…Ù†ØµØ© ØªØ´ÙÙŠØ±</span></div>
    </div>
    <nav class="nav">
      <a href="#" id="aboutBtn" class="btn">Ø¹Ù† Ø§Ù„Ù…Ø·ÙˆÙ‘Ø±</a>
      <span class="badge" id="badge_local">100% Local</span>
      <button id="langBtn" class="btn" aria-label="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ©">EN</button>
      <button id="themeBtn" class="btn" aria-label="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø³ÙÙ…Ø©">â˜¾</button>
    </nav>
  </header>

  <div class="hero-sub container">
    <h1 class="title" style="font-size:28px" id="t_hero_title">Ø£Ø¯Ø§Ø© ØªØ´ÙÙŠØ± ÙˆÙÙƒ ØªØ´ÙÙŠØ± Ø¨Ù†Ù‚Ø±Ø© ÙˆØ§Ø­Ø¯Ø©</h1>
    <div class="muted" id="t_hero_sub">Ù„Ø§ Ø³ÙŠØ±ÙØ±ØŒ Ù„Ø§ ØªØ¹Ù‚ÙŠØ¯ â€” Ø¢Ù…Ù†Ø© ÙˆØ³Ù‡Ù„Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù….</div>
  </div>

  <main class="hero">
    <section class="card" id="app">
      <div class="head">
        <h2 class="title" id="t_input_title">Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ</h2>
        <span class="chip" id="t_privacy">Ù…Ø­Ù„ÙŠ 100% â€¢ Ù„Ø§ Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø³ÙŠØ±ÙØ±</span>
      </div>
      <div class="stack" style="padding:12px">
        <textarea id="plain" placeholder="Ø§ÙƒØªØ¨ Ø£Ùˆ Ø£Ù„ØµÙ‚ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§..."></textarea>
        <div class="row" id="algos">
          <div class="panel">
            <label class="muted" id="t_algo">Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ©</label>
            <select id="algo">
              <option value="aes-gcm">AESâ€‘GCM (ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±)</option>
              <option value="aes-cbc">AESâ€‘CBC (ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±)</option>
            </select>
          </div>
          <div class="panel" id="pwPanel">
            <label class="muted" id="t_password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
            <div style="display:flex;gap:8px;align-items:center">
              <input id="password" type="password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±" />
              <button id="togglePw" class="btn" title="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡" aria-label="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡">ğŸ‘ï¸</button>
            </div>
          </div>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button id="encBtn" class="btn btn-primary">ØªØ´ÙÙŠØ±</button>
          <button id="decBtn" class="btn">ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ±</button>
          <button id="copyBtn" class="btn" title="Ù†Ø³Ø®" aria-label="Ù†Ø³Ø®">Ù†Ø³Ø®</button>
          <button id="downloadBtn" class="btn" title="ØªÙ†Ø²ÙŠÙ„" aria-label="ØªÙ†Ø²ÙŠÙ„">ØªÙ†Ø²ÙŠÙ„</button>
          <button id="clearBtn" class="btn" title="Ù…Ø³Ø­" aria-label="Ù…Ø³Ø­">Ù…Ø³Ø­</button>
        </div>
      </div>
    </section>

    <aside class="card">
      <div class="head">
        <h2 class="title" id="t_output_title">Ø§Ù„Ù†Ø§ØªØ¬</h2>
        <span class="chip mono" id="t_stack_chip">AES â€¢ PBKDF2 â€¢ Ù…Ø­Ù„ÙŠ</span>
      </div>
      <div class="stack" style="padding:12px">
        <div class="panel">
          <label class="muted" id="t_cipher">Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø´ÙØ± / Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„</label>
          <textarea id="ciphertext" placeholder="Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø´ÙØ±ØŒ Ø£Ùˆ Ø£Ù„ØµÙ‚ Ù†ØµÙ‹Ø§ Ù…Ø´ÙØ±Ù‹Ø§ Ù„ÙÙƒÙ‘Ù‡"></textarea>
        </div>
        <div class="panel">
          <label class="muted" id="t_result">Ø§Ù„Ù†ØªÙŠØ¬Ø©</label>
          <div id="result" class="out mono"></div>
        </div>
        <div class="chips" id="stats"></div>
      </div>
    </aside>
  </main>

  <footer class="footer">
    <div>Â© <span id="t_brand">MR CODE</span> â€” <span id="t_footer">Ø£Ø¯Ø§Ø© ØªØ´ÙÙŠØ± Ø§Ø­ØªØ±Ø§ÙÙŠØ©</span></div>
    <div class="mono">v1.0</div>
  </footer>

  <div class="modal" id="aboutModal" aria-hidden="true" role="dialog">
    <div class="modal-card">
      <div class="modal-head">
        <h3 class="title" id="t_about_title">Ø¹Ù† Ø§Ù„Ù…Ø·ÙˆÙ‘Ø±</h3>
        <button id="aboutClose" class="btn" aria-label="Ø¥ØºÙ„Ø§Ù‚">Ã—</button>
      </div>
      <div class="modal-body">
        <p id="t_about_p1">Ø§Ù„Ù…Ø·ÙˆÙ‘Ø±: <b>Ù…Ø­Ù…Ø¯ Ø¥ÙŠÙ‡Ø§Ø¨</b> ğŸ‡ªğŸ‡¬</p>
        <p id="t_about_p2">Ù…ØµØ±ÙŠØŒ Ø£Ù†Ø´Ø£Øª Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©.</p>
        <p id="t_about_p3">Ø®Ø¨Ø±Ø§Øª: HTML, PHP, Python, Lua, Java</p>
        <p id="t_about_p4">Ø®Ø¨Ø±Ø© ÙÙŠ Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ ÙˆØªØ·ÙˆÙŠØ± ÙˆØªØ¯Ø±ÙŠØ¨ ÙˆØ¨Ø±Ù…Ø¬Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ.</p>
        <p><b id="t_contact_title">Ù„Ù„ØªÙˆØ§ØµÙ„ Ø­Ø³Ø§Ø¨Ø§ØªÙ†Ø§ Ø§Ù„Ø±Ø³Ù…ÙŠØ©:</b></p>
        <ul>
          <li><a href="https://api.whatsapp.com/send/?phone=201007856994&text&type=phone_number&app_absent=0" target="_blank" id="t_contact_whatsapp">ÙˆØ§ØªØ³Ø§Ø¨</a></li>
          <li><a href="https://t.me/l00x99" target="_blank" id="t_contact_telegram">ØªÙ„ÙŠØ¬Ø±Ø§Ù…</a></li>
          <li><a href="https://github.com/l00x99" target="_blank" id="t_contact_github">Ø¬ÙŠØª Ù‡ÙˆØ¨</a></li>
        </ul>
      </div>
    </div>
  </div>

<script>
// ========================= I18N =========================
const t = {
  ar:{
    brand_top:"MR CODE", brand_sublabel:"Ù…Ù†ØµØ© ØªØ´ÙÙŠØ±",
    hero_title:"Ø£Ø¯Ø§Ø© ØªØ´ÙÙŠØ± ÙˆÙÙƒ ØªØ´ÙÙŠØ± Ø¨Ù†Ù‚Ø±Ø© ÙˆØ§Ø­Ø¯Ø©", hero_sub:"Ù„Ø§ Ø³ÙŠØ±ÙØ±ØŒ Ù„Ø§ ØªØ¹Ù‚ÙŠØ¯ â€” Ø¢Ù…Ù†Ø© ÙˆØ³Ù‡Ù„Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù….",
    input_title:"Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ", privacy:"Ù…Ø­Ù„ÙŠ 100% â€¢ Ù„Ø§ Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø³ÙŠØ±ÙØ±", algo:"Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ©",
    password:"ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±", pw_ph:"Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±",
    output_title:"Ø§Ù„Ù†Ø§ØªØ¬", cipher:"Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø´ÙØ± / Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„", cipher_ph:"Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø´ÙØ±ØŒ Ø£Ùˆ Ø£Ù„ØµÙ‚ Ù†ØµÙ‹Ø§ Ù…Ø´ÙØ±Ù‹Ø§ Ù„ÙÙƒÙ‘Ù‡",
    result:"Ø§Ù„Ù†ØªÙŠØ¬Ø©", brand:"MR CODE", footer:"Ø£Ø¯Ø§Ø© ØªØ´ÙÙŠØ± Ø§Ø­ØªØ±Ø§ÙÙŠØ©", stack_chip:"AES â€¢ PBKDF2 â€¢ Ù…Ø­Ù„ÙŠ",
    enc:"ØªØ´ÙÙŠØ±", dec:"ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ±", copy:"Ù†Ø³Ø®", download:"ØªÙ†Ø²ÙŠÙ„", clear:"Ù…Ø³Ø­", placeholder_in:"Ø§ÙƒØªØ¨ Ø£Ùˆ Ø£Ù„ØµÙ‚ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§...",
    about_btn:"Ø¹Ù† Ø§Ù„Ù…Ø·ÙˆÙ‘Ø±", about_title:"Ø¹Ù† Ø§Ù„Ù…Ø·ÙˆÙ‘Ø±",
    about_p1:"Ø§Ù„Ù…Ø·ÙˆÙ‘Ø±: <b>Ù…Ø­Ù…Ø¯ Ø¥ÙŠÙ‡Ø§Ø¨</b> ğŸ‡ªğŸ‡¬",
    about_p2:"Ù…ØµØ±ÙŠØŒ Ø£Ù†Ø´Ø£Øª Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©.",
    about_p3:"Ø®Ø¨Ø±Ø§Øª: HTML, PHP, Python, Lua, Java",
    about_p4:"Ø®Ø¨Ø±Ø© ÙÙŠ Ø§Ù„Ø£Ù…Ù† Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ ÙˆØªØ·ÙˆÙŠØ± ÙˆØªØ¯Ø±ÙŠØ¨ ÙˆØ¨Ø±Ù…Ø¬Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ.",
    contact_title: "Ù„Ù„ØªÙˆØ§ØµÙ„ Ø­Ø³Ø§Ø¨Ø§ØªÙ†Ø§ Ø§Ù„Ø±Ø³Ù…ÙŠØ©:",
    contact_whatsapp: "ÙˆØ§ØªØ³Ø§Ø¨",
    contact_telegram: "ØªÙ„ÙŠØ¬Ø±Ø§Ù…",
    contact_github: "Ø¬ÙŠØª Ù‡ÙˆØ¨",
    stats_chars:"Ø£Ø­Ø±Ù"
  },
  en:{
    brand_top:"MR CODE", brand_sublabel:"Encryption Suite",
    hero_title:"Oneâ€‘click Encrypt & Decrypt", hero_sub:"No server, no hassle â€” secure and easy.",
    input_title:"Original text", privacy:"100% Local â€¢ No server", algo:"Algorithm",
    password:"Password", pw_ph:"Enter password",
    output_title:"Output", cipher:"Ciphertext / Input", cipher_ph:"Ciphertext will appear here, or paste one to decrypt",
    result:"Result", brand:"MR CODE", footer:"Proâ€‘grade Encryption Tool", stack_chip:"AES â€¢ PBKDF2 â€¢ Local",
    enc:"Encrypt", dec:"Decrypt", copy:"Copy", download:"Download", clear:"Clear", placeholder_in:"Type or paste here...",
    about_btn:"About Developer", about_title:"About the Developer",
    about_p1:"Developer: <b>Mohamed Ehab</b> ğŸ‡ªğŸ‡¬",
    about_p2:"Egyptian; I built this site to enhance privacy.",
    about_p3:"Skills: HTML, PHP, Python, Lua, Java",
    about_p4:"Experience in Cybersecurity and in AI development, training & programming.",
    contact_title: "Official Accounts for Contact:",
    contact_whatsapp: "WhatsApp",
    contact_telegram: "Telegram",
    contact_github: "GitHub",
    stats_chars:"chars"
  }
};
let lang='ar';
function setLang(l){
  lang=l;document.body.setAttribute('data-lang',l);document.documentElement.lang=l;document.documentElement.dir=(l==='ar'?'rtl':'ltr');
  const m=t[l];
  // Header
  document.getElementById('t_brand_top').childNodes[0].nodeValue=m.brand_top+" ";
  document.getElementById('t_brand_sublabel').textContent=m.brand_sublabel;
  // Buttons
  document.getElementById('aboutBtn').textContent=m.about_btn;
  document.getElementById('langBtn').textContent=(l==='ar'?'EN':'Ø¹Ø±Ø¨ÙŠ');
  // Hero
  document.getElementById('t_hero_title').textContent=m.hero_title;
  document.getElementById('t_hero_sub').textContent=m.hero_sub;
  // App
  document.getElementById('t_input_title').textContent=m.input_title;
  document.getElementById('t_privacy').textContent=m.privacy;
  document.getElementById('t_algo').textContent=m.algo;
  document.getElementById('t_password').textContent=m.password;
  document.getElementById('password').placeholder=m.pw_ph;
  document.getElementById('t_output_title').textContent=m.output_title;
  document.getElementById('t_cipher').textContent=m.cipher;
  document.getElementById('ciphertext').placeholder=m.cipher_ph;
  document.getElementById('t_result').textContent=m.result;
  document.getElementById('t_brand').textContent=m.brand;
  document.querySelector('#t_stack_chip').textContent=m.stack_chip;
  document.getElementById('t_footer').textContent=m.footer;
  document.getElementById('encBtn').textContent=m.enc;
  document.getElementById('decBtn').textContent=m.dec;
  document.getElementById('copyBtn').textContent=m.copy;
  document.getElementById('downloadBtn').textContent=m.download;
  document.getElementById('clearBtn').textContent=m.clear;
  document.getElementById('plain').placeholder=m.placeholder_in;
  // About modal
  document.getElementById('t_about_title').textContent=m.about_title;
  document.getElementById('t_about_p1').innerHTML=m.about_p1;
  document.getElementById('t_about_p2').textContent=m.about_p2;
  document.getElementById('t_about_p3').textContent=m.about_p3;
  document.getElementById('t_about_p4').textContent=m.about_p4;
  document.getElementById('t_contact_title').textContent=m.contact_title;
  document.getElementById('t_contact_whatsapp').textContent=m.contact_whatsapp;
  document.getElementById('t_contact_telegram').textContent=m.contact_telegram;
  document.getElementById('t_contact_github').textContent=m.contact_github;
  // algo options
  const map={"aes-gcm":0,"aes-cbc":1};
  const sel=document.getElementById('algo');
  sel.options[map["aes-gcm"]].text = (l==='ar'?"AESâ€‘GCM (ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±)":"AESâ€‘GCM (password)");
  sel.options[map["aes-cbc"]].text = (l==='ar'?"AESâ€‘CBC (ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±)":"AESâ€‘CBC (password)");
}

// ========================= THEME =========================
let isLight=false;function toggleTheme(){isLight=!isLight;document.body.classList.toggle('light',isLight);document.getElementById('themeBtn').textContent=isLight?'â˜€ï¸':'â˜¾';}

// ========================= Crypto utils =========================
function ab2b64(ab){const bytes=new Uint8Array(ab);let bin="";for(let i=0;i<bytes.byteLength;i++)bin+=String.fromCharCode(bytes[i]);return btoa(bin);} 
function b642ab(b64){const bin=atob(b64);const len=bin.length;const bytes=new Uint8Array(len);for(let i=0;i<len;i++)bytes[i]=bin.charCodeAt(i);return bytes.buffer;}
function utf8(s){return new TextEncoder().encode(s)}
function deutf8(b){return new TextDecoder().decode(b)}
function rnd(n){const a=new Uint8Array(n);crypto.getRandomValues(a);return a}

async function deriveKey(pw,salt,iterations,algo){
  const pwKey=await crypto.subtle.importKey('raw',utf8(pw),{name:'PBKDF2'},false,['deriveKey']);
  return crypto.subtle.deriveKey({name:'PBKDF2',hash:'SHA-256',salt,iterations},pwKey,{name:algo==='aes-gcm'?'AES-GCM':'AES-CBC',length:256},false,['encrypt','decrypt']);
}

// PKCS7 padding for AESâ€‘CBC
function pkcs7Pad(bytes){const bs=16;const pad=bs-(bytes.length%bs||bs);const out=new Uint8Array(bytes.length+pad);out.set(bytes,0);out.fill(pad,bytes.length);return out.buffer}
function pkcs7Unpad(buf){const a=new Uint8Array(buf);const pad=a[a.length-1];if(pad<1||pad>16)throw new Error('Bad padding');return a.slice(0,a.length-pad).buffer}

async function encryptUnified(plain,alg,pw,it=150000,saltLen=16){
  const salt=rnd(saltLen);const iv=rnd(alg==='aes-gcm'?12:16);const key=await deriveKey(pw,salt,it,alg);
  let data=utf8(plain);let ct;
  if(alg==='aes-gcm') ct=await crypto.subtle.encrypt({name:'AES-GCM',iv},key,data);
  else ct=await crypto.subtle.encrypt({name:'AES-CBC',iv},key,pkcs7Pad(data));
  return `mrcode:v2:${alg}:${it}:${ab2b64(salt)}:${ab2b64(iv)}:${ab2b64(ct)}`;
}

async function decryptUnified(pack,pw){
  const parts=pack.trim().split(':');
  if(parts.length!==7 || parts[0]!=='mrcode' || parts[1]!=='v2') throw new Error('Bad format');
  const alg=parts[2];const it=parseInt(parts[3]);const s=parts[4], v=parts[5], d=parts[6];
  const salt=new Uint8Array(b642ab(s));const iv=new Uint8Array(b642ab(v));const ct=b642ab(d);
  const key=await deriveKey(pw,salt,it,alg);
  if(alg==='aes-gcm'){
    const pt=await crypto.subtle.decrypt({name:'AES-GCM',iv},key,ct);return deutf8(pt);
  }else{
    const pt=await crypto.subtle.decrypt({name:'AES-CBC',iv},key,ct);return deutf8(pkcs7Unpad(pt));
  }
}

// ========================= UI Logic =========================
const els={plain:document.getElementById('plain'), algo:document.getElementById('algo'), pw:document.getElementById('password'), cipher:document.getElementById('ciphertext'), result:document.getElementById('result'), stats:document.getElementById('stats'),
enc:document.getElementById('encBtn'), dec:document.getElementById('decBtn'), copy:document.getElementById('copyBtn'), dl:document.getElementById('downloadBtn'), clear:document.getElementById('clearBtn'), pwPanel:document.getElementById('pwPanel'),
langBtn:document.getElementById('langBtn'), themeBtn:document.getElementById('themeBtn'), togglePw:document.getElementById('togglePw'), aboutBtn:document.getElementById('aboutBtn'), aboutModal:document.getElementById('aboutModal'), aboutClose:document.getElementById('aboutClose')};

function needPassword(){return ['aes-gcm','aes-cbc'].includes(els.algo.value)}
function refreshPwPanel(){els.pwPanel.style.display = needPassword()? 'block':'none'}
function updateStats(){const txt=els.cipher.value||'';const unit=t[lang].stats_chars;els.stats.innerHTML=`<span class="chip">${txt.length} ${unit}</span>`}

els.algo.addEventListener('change',refreshPwPanel);
els.togglePw.onclick=()=>{els.pw.type=(els.pw.type==='password'?'text':'password')};
els.langBtn.onclick=()=>{setLang(lang==='ar'?'en':'ar')};
els.themeBtn.onclick=toggleTheme;
els.cipher.addEventListener('input',updateStats);

// About modal open/close
els.aboutBtn.onclick=(e)=>{e.preventDefault();els.aboutModal.classList.add('open')}
els.aboutClose.onclick=()=>els.aboutModal.classList.remove('open')
els.aboutModal.addEventListener('click',(e)=>{if(e.target===els.aboutModal)els.aboutModal.classList.remove('open')})

els.enc.onclick=async()=>{
  const alg=els.algo.value;const text=els.plain.value; if(!text){els.result.textContent= lang==='ar'? 'Ø§ÙƒØªØ¨ Ù†ØµÙ‹Ø§ Ù„Ù„ØªØ´ÙÙŠØ±.' : 'Type some text to encrypt.'; return}
  if(needPassword() && (!els.pw.value || els.pw.value.length<6)){els.result.textContent = lang==='ar'? 'Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø£Ù‚ÙˆÙ‰ (6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„).' : 'Enter a stronger password (min 6).'; return}
  try{const pack=await encryptUnified(text,alg,els.pw.value);els.cipher.value=pack;els.result.textContent= lang==='ar'? 'âœ… ØªÙ… Ø§Ù„ØªØ´ÙÙŠØ±.' : 'âœ… Encrypted.';updateStats();}
  catch(e){els.result.textContent= (lang==='ar'? 'Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ´ÙÙŠØ±: ' : 'Encryption error: ')+ e.message}
}
els.dec.onclick=async()=>{
  const pack=els.cipher.value; if(!pack){els.result.textContent= lang==='ar'? 'Ø£Ù„ØµÙ‚ Ù†ØµÙ‹Ø§ Ù…Ø´ÙØ±Ù‹Ø§ Ø£ÙˆÙ„Ù‹Ø§.' : 'Paste a packed ciphertext first.'; return}
  try{const text=await decryptUnified(pack,els.pw.value);els.plain.value=text;els.result.textContent= lang==='ar'? 'ğŸ”“ ØªÙ… ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ±.' : 'ğŸ”“ Decrypted.';}
  catch(e){els.result.textContent=(lang==='ar'? 'ÙØ´Ù„ ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ±: ' : 'Decryption failed: ')+e.message}
}
els.copy.onclick=()=>{const s=els.cipher.value||els.plain.value; if(!s){els.result.textContent= lang==='ar'? 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø§ ÙŠØªÙ… Ù†Ø³Ø®Ù‡.' : 'Nothing to copy.';return} navigator.clipboard.writeText(s);els.result.textContent=lang==='ar'? 'ğŸ“‹ ØªÙ… Ø§Ù„Ù†Ø³Ø®.' : 'ğŸ“‹ Copied.'}
els.dl.onclick=()=>{const data=els.cipher.value||els.plain.value; if(!data){els.result.textContent= lang==='ar'? 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø§ ÙŠØªÙ… ØªÙ†Ø²ÙŠÙ„Ù‡.' : 'Nothing to download.';return} const blob=new Blob([data],{type:'text/plain'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='mrcode.txt';a.click();}
els.clear.onclick=()=>{els.plain.value='';els.cipher.value='';els.result.textContent='';updateStats()}

// init
setLang('ar');refreshPwPanel();
</script>
</body>
</html>